{% extends 'bookkepping/base.html' %}
{% block title %}Trial Balance - Bookkeeping System{% endblock %}

{% block content %}
<h2>‚öñÔ∏è Trial Balance Report</h2>

<div class="stats">
  <div class="stat-card">
    <h3>{{ accounts|length }}</h3>
    <p>Total Accounts</p>
  </div>
  <div class="stat-card">
    <h3>${{ total_debits|floatformat:2 }}</h3>
    <p>Total Debits</p>
  </div>
  <div class="stat-card">
    <h3>${{ total_credits|floatformat:2 }}</h3>
    <p>Total Credits</p>
  </div>
  <div class="stat-card {% if total_debits == total_credits %}stat-card{% else %}stat-card-danger{% endif %}">
    <h3>{% if total_debits == total_credits %}‚úÖ{% else %}‚ùå{% endif %}</h3>
    <p>Balance Status</p>
  </div>
</div>

<div style="margin-bottom: 20px;">
  <a href="{% url 'bookkeeping:export_trial_pdf' %}" class="btn" style="margin-right: 10px;">üìÑ Export PDF</a>
  <a href="{% url 'bookkeeping:export_ledger_xlsx' %}" class="btn">üìä Export Excel</a>
</div>

<div style="overflow-x: auto;">
  <table>
    <thead>
      <tr>
        <th>Account Name</th>
        <th>Account Type</th>
        <th>Debit Balance</th>
        <th>Credit Balance</th>
        <th>Net Balance</th>
      </tr>
    </thead>
    <tbody>
      {% for account in accounts %}
      <tr>
        <td>
          <strong>{{ account.name }}</strong>
        </td>
        <td>
          <span class="badge badge-{{ account.type }}">
            {% if account.type == 'asset' %}üè¶{% elif account.type == 'liability' %}üìã{% elif account.type == 'equity' %}üë§{% elif account.type == 'income' %}üí∞{% else %}üí∏{% endif %}
            {{ account.type|title }}
          </span>
        </td>
        <td>
          <span class="debit-amount">
            {% if account.debit_total > 0 %}
              ${{ account.debit_total|floatformat:2 }}
            {% else %}
              $0.00
            {% endif %}
          </span>
        </td>
        <td>
          <span class="credit-amount">
            {% if account.credit_total > 0 %}
              ${{ account.credit_total|floatformat:2 }}
            {% else %}
              $0.00
            {% endif %}
          </span>
        </td>
        <td>
          <span class="net-balance {% if account.debit_total > account.credit_total %}positive{% else %}negative{% endif %}">
            {% if account.debit_total > account.credit_total %}
              ${{ account.debit_total|floatformat:2 }}
            {% elif account.credit_total > account.debit_total %}
              ${{ account.credit_total|floatformat:2 }}
            {% else %}
              $0.00
            {% endif %}
          </span>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" style="text-align: center; padding: 40px; color: #7f8c8d;">
          <p>No accounts found. <a href="/admin/bookkepping/account/add/" class="btn">Create your first account</a></p>
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr style="background: linear-gradient(45deg, #34495e, #2c3e50); color: white; font-weight: bold;">
        <td colspan="2"><strong>TOTALS</strong></td>
        <td><strong>${{ total_debits|floatformat:2 }}</strong></td>
        <td><strong>${{ total_credits|floatformat:2 }}</strong></td>
        <td>
          <strong class="{% if total_debits == total_credits %}balance-balanced{% else %}balance-unbalanced{% endif %}">
            {% if total_debits == total_credits %}
              ‚úÖ BALANCED
            {% else %}
              ‚ùå UNBALANCED
            {% endif %}
          </strong>
        </td>
      </tr>
    </tfoot>
  </table>
</div>

<div style="margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
  <h3>üìä Summary</h3>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
    <div>
      <strong>Total Debits:</strong> ${{ total_debits|floatformat:2 }}
    </div>
    <div>
      <strong>Total Credits:</strong> ${{ total_credits|floatformat:2 }}
    </div>
    <div>
      <strong>Difference:</strong> 
      <span class="{% if total_debits == total_credits %}balance-balanced{% else %}balance-unbalanced{% endif %}">
        ${{ difference|floatformat:2 }}
      </span>
    </div>
    <div>
      <strong>Status:</strong> 
      <span class="{% if total_debits == total_credits %}balance-balanced{% else %}balance-unbalanced{% endif %}">
        {% if total_debits == total_credits %}‚úÖ Balanced{% else %}‚ùå Unbalanced{% endif %}
      </span>
    </div>
  </div>
</div>

<style>
.badge {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.badge-asset { background: linear-gradient(45deg, #27ae60, #2ecc71); color: white; }
.badge-liability { background: linear-gradient(45deg, #e74c3c, #c0392b); color: white; }
.badge-equity { background: linear-gradient(45deg, #9b59b6, #8e44ad); color: white; }
.badge-income { background: linear-gradient(45deg, #f39c12, #e67e22); color: white; }
.badge-expense { background: linear-gradient(45deg, #34495e, #2c3e50); color: white; }

.debit-amount {
  color: #e74c3c;
  font-weight: 600;
}

.credit-amount {
  color: #27ae60;
  font-weight: 600;
}

.net-balance {
  font-weight: 600;
  font-size: 16px;
}

.net-balance.positive { color: #27ae60; }
.net-balance.negative { color: #e74c3c; }

.balance-balanced {
  color: #27ae60;
  font-weight: bold;
}

.balance-unbalanced {
  color: #e74c3c;
  font-weight: bold;
}

.stat-card-danger {
  background: linear-gradient(45deg, #e74c3c, #c0392b) !important;
}

table tfoot td {
  text-align: center;
}

@media (max-width: 768px) {
  .stats {
    grid-template-columns: repeat(2, 1fr);
  }
  
  table {
    font-size: 14px;
  }
  
  th, td {
    padding: 10px 8px;
  }
}
</style>
{% endblock %}